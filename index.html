<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
 
    <title>Audio Visulizer</title>
	<link rel="stylesheet" href="./app.css"/>
	<script type="text/javascript" src="./dist/index.js"></script>
</head>

<body onload='init()'>
	<div id="main-content-container" >
		<button onclick="start()">start</button>
		<button onclick="stop()">stop</button>
		<div id="visualizer_wrapper">
			<canvas id='canvas' width="800" height="350"></canvas>
		</div>
    </div>
    <script>		
		const url = 'ws://109.123.120.200:8080';
		const ws = new WebSocket(url);
		// 接受二进制数据，需要配置binaryType
		ws.binaryType = 'arraybuffer';
		let player;

        const init = () => {
			console.log(`[${new Date()}] AudioCapture App Start...`);
			
			player = new StreamVisulizer();
        }
		
		const start = () => {
			// 绑定链接open & close 事件
			ws.addEventListener('open', event => (console.log(`[${new Date()}] ws server open sucess!`)));
			ws.addEventListener('close', event => (console.log(`[${new Date()}] ws server closed!`)));

			ws.addEventListener('message', event => {
				let raw = new Uint8Array(event.data);				
				player.feed(raw);
			});
		}
		const stop = () => {
			player.stop();
		}


    </script>
</body>
</html>